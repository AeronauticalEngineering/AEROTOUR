<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Admin ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="config.js"></script>
</head>

<body class="bg-gray-50 min-h-screen flex">
  <!-- Side Navigation -->
  <aside class="w-56 bg-[#0A164D] shadow-lg flex flex-col">
    <div class="p-4 text-white font-bold text-xl border-b border-[#EB8012]">
      <span>AEROTOUR</span>
    </div>
    <nav class="flex-1 mt-2 px-2">
      <a href="#" class="block p-3 text-white bg-[#EB8012] rounded-lg mb-2 transition-all font-medium">
        Dashboard
      </a>
      <a href="addevent.html" class="block p-3 text-gray-300 hover:bg-[#1a2d6b] rounded-lg mb-2 transition-all font-medium">
        Event
      </a>
      <a href="Member.html" class="block p-3 text-gray-300 hover:bg-[#1a2d6b] rounded-lg transition-all font-medium">
        Member
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-[#0A164D] mb-1">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h1>
      <p class="text-sm text-gray-500">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>
    </div>

    <!-- Metrics Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-4 shadow-lg">
        <div class="text-sm font-medium opacity-90 mb-2">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div id="metric-total" class="text-3xl font-bold">0</div>
      </div>
      <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-4 shadow-lg">
        <div class="text-sm font-medium opacity-90 mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</div>
        <div id="metric-pending" class="text-3xl font-bold">0</div>
      </div>
      <div class="bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl p-4 shadow-lg">
        <div class="text-sm font-medium opacity-90 mb-2">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</div>
        <div id="metric-cancle" class="text-3xl font-bold">0</div>
      </div>
      <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-4 shadow-lg">
        <div class="text-sm font-medium opacity-90 mb-2">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</div>
        <div id="metric-done" class="text-3xl font-bold">0</div>
      </div>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
      <div class="flex items-center gap-4">
        <span class="text-sm font-medium text-gray-700">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á:</span>
        <div class="flex gap-3 flex-1">
          <select id="filter-status" class="border border-gray-300 px-3 py-2 bg-white rounded-lg text-sm focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none transition-all">
            <option value="">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="‡∏à‡∏≠‡∏á">‡∏à‡∏≠‡∏á</option>
            <option value="‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</option>
            <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
            <option value="‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°">‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
          </select>
          <input type="date" id="filter-date" class="border border-gray-300 px-3 py-2 bg-white rounded-lg text-sm focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none transition-all">
        </div>
      </div>
    </div>

    <!-- Groups Container -->
    <div id="groups-container" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4"></div>
  </main>
  </div>

  <!-- Modals -->
  <!-- 1) Update Payment -->
  <div id="update-payment-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl transform transition-all">
      <div class="bg-gradient-to-r from-[#0A164D] to-[#1a2d6b] text-white p-5 rounded-t-2xl">
        <h2 class="text-lg font-bold">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
      </div>
      <form id="update-payment-form" class="p-5">
        <input type="hidden" id="payment-update-id">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
          <select id="update-payment-select" class="w-full border-2 border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none transition-all">
            <option value="‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
            <option value="‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</option>
            <option value="‡πÅ‡∏à‡πâ‡∏á‡∏™‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô">‡πÅ‡∏à‡πâ‡∏á‡∏™‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</option>
            <option value="‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
            <option value="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button type="button" onclick="closePaymentModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium transition-all">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="submit" class="flex-1 bg-gradient-to-r from-[#EB8012] to-[#ff9933] hover:from-[#d67010] hover:to-[#EB8012] text-white px-4 py-3 rounded-lg font-medium transition-all shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 2) Update Join -->
  <div id="update-join-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl transform transition-all">
      <div class="bg-gradient-to-r from-[#0A164D] to-[#1a2d6b] text-white p-5 rounded-t-2xl">
        <h2 class="text-lg font-bold">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h2>
      </div>
      <form id="update-join-form" class="p-5">
        <input type="hidden" id="join-update-id">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</label>
          <select id="update-join-select" class="w-full border-2 border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none transition-all">
            <option value="‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß">‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
            <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button type="button" onclick="closeJoinModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium transition-all">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="submit" class="flex-1 bg-gradient-to-r from-[#EB8012] to-[#ff9933] hover:from-[#d67010] hover:to-[#EB8012] text-white px-4 py-3 rounded-lg font-medium transition-all shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 3) Update Confirm -->
  <div id="update-confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl transform transition-all">
      <div class="bg-gradient-to-r from-[#0A164D] to-[#1a2d6b] text-white p-5 rounded-t-2xl">
        <h2 class="text-lg font-bold">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</h2>
      </div>
      <form id="update-confirm-form" class="p-5">
        <input type="hidden" id="confirm-update-id">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</label>
          <select id="update-confirm-select" class="w-full border-2 border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none transition-all">
            <option value="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
            <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button type="button" onclick="closeConfirmModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium transition-all">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="submit" class="flex-1 bg-gradient-to-r from-[#EB8012] to-[#ff9933] hover:from-[#d67010] hover:to-[#EB8012] text-white px-4 py-3 rounded-lg font-medium transition-all shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 4) Update Group Join -->
  <div id="update-group-join-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl transform transition-all">
      <div class="bg-gradient-to-r from-[#0A164D] to-[#1a2d6b] text-white p-5 rounded-t-2xl">
        <h2 class="text-lg font-bold">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (‡∏Å‡∏•‡∏∏‡πà‡∏°)</h2>
      </div>
      <form id="update-group-join-form" class="p-5">
        <input type="hidden" id="group-join-update-id">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</label>
          <select id="update-group-join-select" class="w-full border-2 border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-all transition-all">
            <option value="‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß">‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
            <option value="‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button type="button" onclick="closeGroupJoinModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium transition-all">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="submit" class="flex-1 bg-gradient-to-r from-[#EB8012] to-[#ff9933] hover:from-[#d67010] hover:to-[#EB8012] text-white px-4 py-3 rounded-lg font-medium transition-all shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 5) Update Group Confirm -->
  <div id="update-group-confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-md shadow-2xl transform transition-all">
      <div class="bg-gradient-to-r from-[#0A164D] to-[#1a2d6b] text-white p-5 rounded-t-2xl">
        <h2 class="text-lg font-bold">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
      </div>
      <form id="update-group-confirm-form" class="p-5">
        <input type="hidden" id="group-confirm-update-id">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
          <select id="update-group-confirm-select" class="w-full border-2 border-gray-300 px-4 py-3 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none transition-all">
            <option value="‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
            <option value="‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°">‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
            <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button type="button" onclick="closeGroupConfirmModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium transition-all">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="submit" class="flex-1 bg-gradient-to-r from-[#EB8012] to-[#ff9933] hover:from-[#d67010] hover:to-[#EB8012] text-white px-4 py-3 rounded-lg font-medium transition-all shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </form>
    </div>
  </div>
  <!-- 6) Edit Modal -->
  <div id="edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl w-full max-w-3xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col">
      <div class="bg-gradient-to-r from-[#0A164D] to-[#1a2d6b] text-white p-5">
        <h2 class="text-lg font-bold">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h2>
      </div>
      <form id="edit-form" class="p-6 overflow-y-auto flex-1">
        <input type="hidden" id="edit-id">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">Event ID</label>
            <input id="edit-eventId" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
            <input id="edit-activityName" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
            <input id="edit-category" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤</label>
            <input id="edit-price" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input id="edit-date" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡πÄ‡∏ß‡∏•‡∏≤</label>
            <input id="edit-time" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
            <input id="edit-queue" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</label>
            <input id="edit-bookerName" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠ ENG</label>
            <input id="edit-bookerENG" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ ‡∏õ‡∏ä‡∏ä.</label>
            <input id="edit-idCard" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
            <input id="edit-address" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
            <input id="edit-phone" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            <input id="edit-email" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</label>
            <input type="url" id="edit-invoice" class="w-full border-2 border-gray-300 p-2 rounded-lg mb-1 focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå">
            <input type="file" id="upload-invoice" class="block w-full text-xs text-gray-700 file:mr-2 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:bg-[#EB8012] file:text-white hover:file:bg-[#d67010]">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</label>
            <input type="url" id="edit-receipt" class="w-full border-2 border-gray-300 p-2 rounded-lg mb-1 focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå">
            <input type="file" id="upload-receipt" class="block w-full text-xs text-gray-700 file:mr-2 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:bg-[#EB8012] file:text-white hover:file:bg-[#d67010]">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</label>
            <input type="url" id="edit-certificate" class="w-full border-2 border-gray-300 p-2 rounded-lg mb-1 focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå">
            <input type="file" id="upload-certificate" class="block w-full text-xs text-gray-700 file:mr-2 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:bg-[#EB8012] file:text-white hover:file:bg-[#d67010]">
          </div>
        </div>
        <div class="mt-4">
          <label class="block text-xs font-medium text-gray-600 mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
          <textarea id="edit-note" rows="3" class="w-full border-2 border-gray-300 p-2 rounded-lg focus:ring-2 focus:ring-[#EB8012] focus:border-transparent outline-none text-sm"></textarea>
        </div>
        <div class="flex gap-3 mt-6">
          <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium transition-all">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="submit" class="flex-1 bg-gradient-to-r from-[#EB8012] to-[#ff9933] hover:from-[#d67010] hover:to-[#EB8012] text-white px-4 py-3 rounded-lg font-medium transition-all shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 flex flex-col items-center shadow-2xl">
      <div class="animate-spin rounded-full h-16 w-16 border-4 border-[#EB8012] border-t-transparent mb-4"></div>
      <span class="text-[#0A164D] text-lg font-medium">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</span>
    </div>
  </div>

  <!-- Script -->
  <script>
    let tableData = [];
    let eventCaps = {};

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô
function startLoading() {
  // ‡πÅ‡∏™‡∏î‡∏á overlay
  $('#loading-overlay').removeClass('hidden');
  // ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥
  $('button').prop('disabled', true);
}

function stopLoading() {
  // ‡∏ã‡πà‡∏≠‡∏ô overlay
  $('#loading-overlay').addClass('hidden');
  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö
  $('button').prop('disabled', false);
}

    async function fetchData() {
      startLoading();
      try {
        const resp = await fetch(ADMIN_URL);
        const { appointments, events } = await resp.json();

        // capacity map - ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå D (index 3)
        eventCaps = {};
        events.slice(1).forEach(r => {
          const evtId = String(r[0]); // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A: ‡πÑ‡∏≠‡∏î‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
          const cap = Number(r[3]) || 0; // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå D: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≥‡∏Å‡∏±‡∏î
          eventCaps[evtId] = cap;
        });

        tableData = appointments.slice(1).map(r => ({
          id: String(r[0]), eventId: String(r[1]), activityName: r[2], category: r[3],
          price: r[4], date: r[5], time: r[6], queue: r[7], bookerName: r[8],
          bookerENG: r[9], idCard: r[10], address: r[11], phone: r[12], email: r[13],
          note: r[14], status: r[15], payment: r[16], joinStatus: r[17],
          confirmStatus: r[18], additionalNotes: r[19],
          useridline: r[20], invoice: r[21], receipt: r[22], certificate: r[23],
          paymentSlip: r[24]   
        }));


        renderMetrics();
        renderGroups();
      } catch {
        Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
      } finally {
        stopLoading();
      }
    }

    function renderMetrics() {
      const total = tableData.length;
      const pending = tableData.filter(x => x.status === '‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°').length;
      const cancle = tableData.filter(x => x.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å').length;
      const done = tableData.filter(x => x.status === '‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°').length;
      $('#metric-total').text(total);
      $('#metric-pending').text(pending);
      $('#metric-cancle').text(cancle);
      $('#metric-done').text(done);
    }

    function groupBy(arr, key) {
      return arr.reduce((a, c) => (a[c[key]] = (a[c[key]] || []).concat(c), a), {});
    }

    function renderGroups() {
      // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
      const statusFilter = $('#filter-status').val();
      const dateFilter = $('#filter-date').val();

      // 1) ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ô‡∏±‡πâ‡∏ô
      //    ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà status === '‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'
      let filtered;
      if (statusFilter) {
        filtered = tableData.filter(x => x.status === statusFilter);
      } else {
        filtered = tableData.filter(x => x.status !== '‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°');
      }

      // 2) ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
      if (dateFilter) {
        const [y, m, d] = dateFilter.split('-');
        filtered = filtered.filter(x => x.date === `${d}-${m}-${y}`);
      }

      // 3) ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏° eventId
      const groups = groupBy(filtered, 'eventId');

      // 4) ‡∏•‡πâ‡∏≤‡∏á container ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏° render ‡πÉ‡∏´‡∏°‡πà
      const cont = $('#groups-container').empty();

      for (const [eid, items] of Object.entries(groups)) {
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• header ‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°
        const h = items[0];
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≠‡∏á
        const booked = items.filter(it => it.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å').length;
        const cap = eventCaps[eid] || 0;
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏Ç‡∏≠‡∏á badge
        const percentage = cap > 0 ? (booked / cap) * 100 : 0;
        let capacityBadgeClass = 'bg-blue-100 text-blue-700';
        let capacityStatus = '';
        
        if (percentage >= 100) {
          capacityBadgeClass = 'bg-red-100 text-red-700 border-2 border-red-400';
          capacityStatus = '‡πÄ‡∏ï‡πá‡∏°';
        } else if (percentage >= 80) {
          capacityBadgeClass = 'bg-orange-100 text-orange-700';
          capacityStatus = '‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏ï‡πá‡∏°';
        } else if (percentage >= 50) {
          capacityBadgeClass = 'bg-yellow-100 text-yellow-700';
        } else {
          capacityBadgeClass = 'bg-green-100 text-green-700';
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
        const box = $(`
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-all duration-300">
      <div class="bg-gradient-to-r from-[#0A164D] to-[#1a2d6b] text-white p-4">
        <div class="flex justify-between items-start mb-3">
          <div class="flex-1">
            <h3 class="font-bold text-lg mb-1">${h.activityName}</h3>
            <div class="text-sm opacity-90 mb-2">
              ${h.date} ‚Ä¢ ${h.time}
            </div>
            <div class="flex items-center gap-2">
              <div class="inline-flex items-center gap-2 ${capacityBadgeClass} px-3 py-1.5 rounded-lg font-bold text-sm">
                <span>${booked}/${cap}</span>
                ${capacityStatus ? `<span class="text-xs font-normal">(${capacityStatus})</span>` : ''}
              </div>
              ${percentage > 0 ? `
              <div class="flex-1 max-w-[100px] bg-white/20 rounded-full h-2 overflow-hidden">
                <div class="h-full ${percentage >= 100 ? 'bg-red-400' : percentage >= 80 ? 'bg-orange-400' : percentage >= 50 ? 'bg-yellow-400' : 'bg-green-400'}" style="width: ${Math.min(percentage, 100)}%"></div>
              </div>
              ` : ''}
            </div>
          </div>
        </div>
        <div class="flex gap-2">
          <button class="flex-1 bg-[#EB8012] hover:bg-[#d67010] text-white py-2.5 px-3 rounded-lg text-sm font-medium transition-all" onclick="openGroupJoinModal('${eid}')">
            ‡πÅ‡∏à‡πâ‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
          </button>
          <button class="flex-1 bg-white/20 hover:bg-white/30 text-white py-2.5 px-3 rounded-lg text-sm font-medium transition-all" onclick="openGroupConfirmModal('${eid}')">
            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
          </button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="bg-gray-50 border-b border-gray-200">
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</th>
              <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
          </thead>
          <tbody class="event-tbody" data-event-id="${eid}"></tbody>
        </table>
        ${items.length > 10 ? `
        <div class="p-3 bg-gray-50 border-t text-center">
          <button class="load-more-btn bg-[#0A164D] hover:bg-[#1a2d6b] text-white px-4 py-2 rounded-lg text-sm font-medium transition-all" onclick="loadMoreItems('${eid}')">
            ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏° (‡πÅ‡∏™‡∏î‡∏á <span class="current-count">10</span>/${items.length})
          </button>
        </div>
        ` : ''}
      </div>
    </div>
  `);

        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°
        box.data('allItems', items);
        box.data('displayedCount', 0);

        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ 10 ‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å
        renderItemsForEvent(box, items, 0, 10);

        // ‡πÅ‡∏õ‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏•‡∏á‡πÉ‡∏ô container
        cont.append(box);
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    function renderItemsForEvent(box, items, start, count) {
      const end = Math.min(start + count, items.length);
      const tbody = box.find('.event-tbody');
      
      for (let i = start; i < end; i++) {
        const it = items[i];
        const statusColor = 
          it.status === '‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°' ? 'bg-green-100 text-green-700' :
          it.status === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'bg-red-100 text-red-700' :
          it.status === '‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°' ? 'bg-purple-100 text-purple-700' :
          'bg-blue-100 text-blue-700';
        
        const confirmColor = 
          it.confirmStatus === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? 'bg-green-100 text-green-700' :
          it.confirmStatus === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'bg-red-100 text-red-700' :
          'bg-gray-100 text-gray-700';

        tbody.append(`
          <tr data-id="${it.id}" class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
            <td class="px-4 py-3 font-medium text-gray-800">${it.bookerName}</td>
            <td class="px-4 py-3">
              <span class="inline-block px-2 py-1 rounded-full text-xs font-medium ${statusColor}">
                ${it.status}
              </span>
            </td>
            <td class="px-4 py-3">
              <span class="inline-block px-2 py-1 rounded-full text-xs font-medium ${confirmColor}">
                ${it.confirmStatus}
              </span>
            </td>
            <td class="px-4 py-3 text-center">
              <button class="bg-[#0A164D] hover:bg-[#1a2d6b] text-white px-3 py-1.5 rounded-lg transition-all text-xs font-medium" onclick="toggleDetailsInGroup('${it.id}', this)">
                <span class="toggle-icon">‚ñº</span>
              </button>
            </td>
          </tr>
        `);
      }
      
      box.data('displayedCount', end);
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
      const loadMoreBtn = box.find('.load-more-btn');
      if (loadMoreBtn.length) {
        loadMoreBtn.find('.current-count').text(end);
        if (end >= items.length) {
          loadMoreBtn.hide();
        }
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°
    function loadMoreItems(eventId) {
      const box = $(`.event-tbody[data-event-id="${eventId}"]`).closest('.bg-white');
      const allItems = box.data('allItems');
      const currentCount = box.data('displayedCount');
      
      renderItemsForEvent(box, allItems, currentCount, 10);
    }


function toggleDetailsInGroup(id, btn) {
  const row = $(btn).closest('tr');
  if (row.next().hasClass('details-row')) {
    row.next().remove();
    $(btn).find('.toggle-icon').text('‚ñº');
    return;
  }
  $(btn).find('.toggle-icon').text('‚ñ≤');
  const it = tableData.find(x => x.id === id);
  const html = `<tr class="details-row bg-gradient-to-br from-gray-50 to-white">
        <td colspan="4" class="p-6 border-t-2 border-[#EB8012]">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div class="space-y-2">
              <div><span class="text-gray-500 text-xs">ID:</span> <span class="font-medium">${it.id}</span></div>
              <div><span class="text-gray-500 text-xs">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</span> <span class="font-medium">${it.activityName}</span></div>
              <div><span class="text-gray-500 text-xs">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</span> <span class="font-medium">${it.category}</span></div>
              <div><span class="text-gray-500 text-xs">‡∏£‡∏≤‡∏Ñ‡∏≤:</span> <span class="font-medium">${it.price} ‡∏ö‡∏≤‡∏ó</span></div>
              <div><span class="text-gray-500 text-xs">‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤:</span> <span class="font-medium">${it.date} ${it.time}</span></div>
              <div><span class="text-gray-500 text-xs">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</span> <span class="font-medium">${it.queue} ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á</span></div>
              <div><span class="text-gray-500 text-xs">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£:</span> <span class="font-medium">${it.idCard}</span></div>
            </div>
            <div class="space-y-2">
              <div><span class="text-gray-500 text-xs">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</span> <span class="font-medium">${it.bookerName}</span></div>
              <div><span class="text-gray-500 text-xs">‡∏ä‡∏∑‡πà‡∏≠ ENG:</span> <span class="font-medium">${it.bookerENG}</span></div>
              <div><span class="text-gray-500 text-xs">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</span> <span class="font-medium">${it.address}</span></div>
              <div><span class="text-gray-500 text-xs">‡πÇ‡∏ó‡∏£:</span> <span class="font-medium">${it.phone}</span></div>
              <div><span class="text-gray-500 text-xs">‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</span> <span class="font-medium">${it.email}</span></div>
              <div><span class="text-gray-500 text-xs">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> <span class="font-medium">${it.note || '-'}</span></div>
            </div>
          </div>
          
          <div class="mt-4 pt-4 border-t border-gray-200">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
              <div class="bg-blue-50 p-2 rounded-lg">
                <div class="text-xs text-gray-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
                <div class="font-medium text-sm">${it.status}</div>
              </div>
              <div class="bg-green-50 p-2 rounded-lg">
                <div class="text-xs text-gray-500">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
                <div class="font-medium text-sm">${it.payment}</div>
              </div>
              <div class="bg-yellow-50 p-2 rounded-lg">
                <div class="text-xs text-gray-500">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</div>
                <div class="font-medium text-sm">${it.joinStatus}</div>
              </div>
              <div class="bg-purple-50 p-2 rounded-lg">
                <div class="text-xs text-gray-500">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</div>
                <div class="font-medium text-sm">${it.confirmStatus}</div>
              </div>
            </div>
            
            ${it.invoice || it.receipt || it.certificate || it.paymentSlip ? `
            <div class="bg-gray-50 p-3 rounded-lg mb-4">
              <div class="text-xs font-medium text-gray-600 mb-2">üìé ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</div>
              <div class="grid grid-cols-2 gap-2">
                ${it.invoice ? `<a href="${it.invoice}" target="_blank" class="text-xs text-blue-600 hover:text-blue-700 bg-white p-2 rounded">‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</a>` : ''}
                ${it.receipt ? `<a href="${it.receipt}" target="_blank" class="text-xs text-blue-600 hover:text-blue-700 bg-white p-2 rounded">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</a>` : ''}
                ${it.certificate ? `<a href="${it.certificate}" target="_blank" class="text-xs text-blue-600 hover:text-blue-700 bg-white p-2 rounded">‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á</a>` : ''}
                ${it.paymentSlip ? `<a href="${it.paymentSlip}" target="_blank" class="text-xs text-blue-600 hover:text-blue-700 bg-white p-2 rounded">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ä‡∏≥‡∏£‡∏∞</a>` : ''}
              </div>
            </div>
            ` : ''}
            
            <div class="flex flex-wrap gap-2">
              <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm" onclick="openPaymentModal('${it.id}')">
                ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
              </button>
              <button class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm" onclick="openJoinModal('${it.id}')">
                ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
              </button>
              <button class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm" onclick="openConfirmModal('${it.id}')">
                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
              </button>
              <button class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm" onclick="openEditModal('${it.id}')">
                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
              </button>
              <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm" onclick="deleteRecord('${it.id}')">
                ‡∏•‡∏ö
              </button>
            </div>
          </div>
        </td>
      </tr>`;
  row.after(html);
}

    // Modal functions & AJAX calls (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    function openPaymentModal(id) { $('#payment-update-id').val(id); $('#update-payment-select').val(tableData.find(x => x.id === id).payment); $('#update-payment-modal').removeClass('hidden'); }
    function closePaymentModal() { $('#update-payment-modal').addClass('hidden'); }
    $('#update-payment-form').on('submit', e => {
      e.preventDefault(); startLoading();
      const id = $('#payment-update-id').val(), payment = $('#update-payment-select').val();
      $.post(ADMIN_URL, { method: 'updatePaymentData', id, payment })
        .done(() => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success'); fetchData(); closePaymentModal(); })
        .fail(() => Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÑ‡∏î‡πâ', 'error'))
        .always(stopLoading);
    });

    function openJoinModal(id) { $('#join-update-id').val(id); $('#update-join-select').val(tableData.find(x => x.id === id).joinStatus); $('#update-join-modal').removeClass('hidden'); }
    function closeJoinModal() { $('#update-join-modal').addClass('hidden'); }
    $('#update-join-form').on('submit', e => {
      e.preventDefault(); startLoading();
      const id = $('#join-update-id').val(), joinStatus = $('#update-join-select').val();
      $.post(ADMIN_URL, { method: 'updateJoinData', id, joinStatus })
        .done(() => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß', 'success'); fetchData(); closeJoinModal(); })
        .fail(() => Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÑ‡∏î‡πâ', 'error'))
        .always(stopLoading);
    });

    function openConfirmModal(id) { $('#confirm-update-id').val(id); $('#update-confirm-select').val(tableData.find(x => x.id === id).confirmStatus); $('#update-confirm-modal').removeClass('hidden'); }
    function closeConfirmModal() { $('#update-confirm-modal').addClass('hidden'); }
    $('#update-confirm-form').on('submit', e => {
      e.preventDefault(); startLoading();
      const id = $('#confirm-update-id').val(), confirmStatus = $('#update-confirm-select').val();
      $.post(ADMIN_URL, { method: 'updateConfirmData', id, confirmStatus })
        .done(() => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success'); fetchData(); closeConfirmModal(); })
        .fail(() => Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÑ‡∏î‡πâ', 'error'))
        .always(stopLoading);
    });

    function openGroupJoinModal(eid) { $('#group-join-update-id').val(eid); $('#update-group-join-select').val('‡πÅ‡∏à‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß'); $('#update-group-join-modal').removeClass('hidden'); }
    function closeGroupJoinModal() { $('#update-group-join-modal').addClass('hidden'); }
    $('#update-group-join-form').on('submit', e => {
      e.preventDefault(); startLoading();
      const eventId = $('#group-join-update-id').val(), joinStatus = $('#update-group-join-select').val();
      $.post(ADMIN_URL, { method: 'updateGroupJoinData', eventId, joinStatus })
        .done(() => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); fetchData(); closeGroupJoinModal(); })
        .fail(() => Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error'))
        .always(stopLoading);
    });

    function openGroupConfirmModal(eid) { $('#group-confirm-update-id').val(eid); $('#update-group-confirm-select').val('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß'); $('#update-group-confirm-modal').removeClass('hidden'); }
    function closeGroupConfirmModal() { $('#update-group-confirm-modal').addClass('hidden'); }
    $('#update-group-confirm-form').on('submit', e => {
      e.preventDefault(); startLoading();
      const eventId = $('#group-confirm-update-id').val(), confirmStatus = $('#update-group-confirm-select').val();
      $.post(ADMIN_URL, { method: 'updateGroupConfirmData', eventId, confirmStatus })
        .done(() => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); fetchData(); closeGroupConfirmModal(); })
        .fail(() => Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error'))
        .always(stopLoading);
    });
    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    function openEditModal(id) {
      const it = tableData.find(x => x.id === id);
      $('#edit-id').val(id);
      $('#edit-eventId').val(it.eventId);
      $('#edit-activityName').val(it.activityName);
      $('#edit-category').val(it.category);
      $('#edit-price').val(it.price);
      $('#edit-date').val(it.date);
      $('#edit-time').val(it.time);
      $('#edit-queue').val(it.queue);
      $('#edit-bookerName').val(it.bookerName);
      $('#edit-bookerENG').val(it.bookerENG);
      $('#edit-idCard').val(it.idCard);
      $('#edit-address').val(it.address);
      $('#edit-phone').val(it.phone);
      $('#edit-email').val(it.email);
      $('#edit-note').val(it.note);
      $('#edit-invoice').val(it.invoice || '');
      $('#edit-receipt').val(it.receipt || '');
      $('#edit-certificate').val(it.certificate || '');

      $('#edit-modal').removeClass('hidden');
    }
    function closeEditModal() {
      $('#edit-modal').addClass('hidden');
    }
    $('#edit-form').on('submit', async function (e) {
      e.preventDefault(); startLoading();

      const invoiceBase64 = await fileToBase64('upload-invoice');
      const receiptBase64 = await fileToBase64('upload-receipt');
      const certificateBase64 = await fileToBase64('upload-certificate');

      const params = {
        method: 'editAppointmentData',
        id: $('#edit-id').val(),
        eventId: $('#edit-eventId').val(),
        activityName: $('#edit-activityName').val(),
        category: $('#edit-category').val(),
        price: $('#edit-price').val(),
        date: $('#edit-date').val(),
        time: $('#edit-time').val(),
        queue: $('#edit-queue').val(),
        bookerName: $('#edit-bookerName').val(),
        bookerENG: $('#edit-bookerENG').val(),
        idCard: $('#edit-idCard').val(),
        address: $('#edit-address').val(),
        phone: $('#edit-phone').val(),
        email: $('#edit-email').val(),
        note: $('#edit-note').val(),
        invoice: $('#edit-invoice').val(),
        receipt: $('#edit-receipt').val(),
        certificate: $('#edit-certificate').val(),
        invoiceBase64,
        receiptBase64,
        certificateBase64
      };

      $.post(ADMIN_URL, params)
        .done(() => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success'); fetchData(); closeEditModal(); })
        .fail(() => Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ', 'error'))
        .always(stopLoading);
    });


    function fileToBase64(fileInputId) {
      return new Promise(resolve => {
        const fileInput = document.getElementById(fileInputId);
        const file = fileInput.files[0];
        if (!file) return resolve('');

        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]); // ‡∏ï‡∏±‡∏î header
        reader.readAsDataURL(file);
      });
    }


    function deleteRecord(id) {
      Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?', icon: 'warning', showCancelButton: true, confirmButtonText: '‡∏•‡∏ö', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' })
        .then(res => {
          if (res.isConfirmed) {
            startLoading();
            $.post(ADMIN_URL, { method: 'deleteAppointmentData', id })
              .done(() => { Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'success'); fetchData(); })
              .fail(() => Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ', 'error'))
              .always(stopLoading);
          }
        });
    }

    $('#filter-status,#filter-date').on('change', () => { renderMetrics(); renderGroups(); });
    window.onload = fetchData;
  </script>
</body>

</html>
